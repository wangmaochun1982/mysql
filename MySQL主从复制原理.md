MySQL主从复制原理以及过程以及用到的三个重要线程

MySQL主从复制工作原理；
在主库上把数据更高记录到二进制日志从库将主库的日志复制到自己的中继日志；
从库读取中继日志的事件，将其重放到从库数据中基本原理流程，3个线程以及之间的关联；
```sql
主：binlog线程——记录下所有改变了数据库数据的语句，放进master上的 binlog中；
从：io线程——在使用start slave 之后，负责从master上拉取 binlog 内容，放进自己的relay log中；
从：sql执行线程——执行relay log中的语句；
```
Binary log：主数据库的二进制日志；
Relay log：从服务器的中继日志；

```sql
MySQL主从复制过程：
第一步：master在每个事务更新数据完成之前，将该操作记录串行地写入到 binlog文件中。binlog 是数据库服务器启动的那一刻起，保存所有修改数据库结构或内容的一个文件。
第二步：salve开启一个I/O Thread，该线程在master打开一个普通连接，主要工作是binlog dump process。如果读取的进度已经跟上了master，就进入睡眠状态并等待master产生新的事件。I/O线程终的目的是将这些事件写入到中继日志中。
第三步：SQL Thread会读取中继日志，并顺序执行该日志中的SQL事件，从而与主数据库中的数据保持一致。
```
由于mysql默认的复制方式是异步的，主库把日志发送给从库后不关心从库是否已经处理，这样会产生一个问题就是假设主库挂了，从库处理失败了，这时候从库升为主库后，日志就丢失了。由此产生两个概念。
全同步复制：
主库写入binlog后强制同步日志到从库，所有的从库都执行完成后才返回给客户端，但是很显然这个方式的话性能会受到严重影响。
半同步复制：
与全同步不同的是，半同步复制的逻辑是这样，从库写入日志成功后返回ACK确认给主库，主库收到至少一个从库的确认就认为写操作完成。
 
